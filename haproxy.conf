#
# Automatically generated configuration.
# Do not edit this file manually.
#

global
    uid                         80
    gid                         80
    chroot                      /var/haproxy
    daemon
    stats                       socket /var/run/haproxy.socket group proxy mode 775 level admin expose-fd listeners
    nbthread                    4
    hard-stop-after             60s
    no strict-limits
    maxconn                     100000
    ocsp-update.mindelay 300
    ocsp-update.maxdelay 3600
    httpclient.resolvers.prefer   ipv4
    tune.ssl.default-dh-param   4096
    ssl-server-verify           none
    spread-checks               2
    tune.bufsize                65536
    tune.lua.maxmem             0
    log                         /var/run/log local0
    lua-prepend-path            /tmp/haproxy/lua/?.lua
    ssl-default-bind-options no-tls-tickets prefer-client-ciphers ssl-min-ver TLSv1.2 ssl-max-ver TLSv1.3
    ssl-default-bind-ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256
    ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
cache opnsense-haproxy-cache
    total-max-size 512
    max-age 60
    process-vary off

defaults
    log     global
    option redispatch -1
    maxconn 10000
    timeout client 1m
    timeout connect 10s
    timeout check 10s
    timeout server 1m
    retries 3
    default-server init-addr last,none

# autogenerated entries for ACLs


# autogenerated entries for config in backends/frontends

# autogenerated entries for stats


# Resolver: DNSDist-Local
resolvers 68a8746891e6b9.77735956
    nameserver 10.1.3.9:53 10.1.3.9:53
    nameserver 10.1.3.10:53 10.1.3.10:53
    resolve_retries 3
    timeout resolve 1s
    timeout retry 1s

# Resolver: Quad9
resolvers 68a874ae62c504.32629239
    nameserver 9.9.9.9:53 9.9.9.9:53
    nameserver 149.112.112.112:53 149.112.112.112:53
    resolve_retries 3
    timeout resolve 1s
    timeout retry 1s



# Frontend: HTTP (HTTP Frontend)
frontend HTTP
    bind 10.1.3.1:82 name 10.1.3.1:82 
    mode http
    option http-keep-alive
    default_backend homepage-webui
    # remove quotes from persistence cookie
    http-request replace-header Cookie '^(.*?; )?(SRVCOOKIE=)"([^;"]*)"(;.*)?$' \1\2\3\4

    # logging options
    # ACL: Not SSL (HTTPS)
    acl acl_68a86fb40a6ac8.48682322 ssl_fc

    # ACTION: Redirect non-HTTPS
    http-request redirect scheme https if !acl_68a86fb40a6ac8.48682322

# Frontend: HTTPS (HTTPS Frontend)
frontend HTTPS
    bind 10.1.3.1:445 name 10.1.3.1:445 ssl strict-sni  alpn h2,http/1.1 crt-list /tmp/haproxy/ssl/68a88a34872a67.77948919.certlist 
    mode http
    option http-keep-alive
    default_backend homepage-webui
    # remove quotes from persistence cookie
    http-request replace-header Cookie '^(.*?; )?(SRVCOOKIE=)"([^;"]*)"(;.*)?$' \1\2\3\4

    # logging options
    # ACL: Internal Network
    acl acl_68a88bcbc80209.70803030 req.hdr_ip(X-Forwarded-For,1) -m beg 10.1
    # ACL: Podcake Domain
    acl acl_68a885aae80c10.90079068 hdr_end(host) -i podcake.net
    # ACL: NOAA Domain
    acl acl_68a884cc6b90c7.72313124 hdr_end(host) -i noaa.cc

    # ACTION: Internal Hosts
    use_backend %[req.hdr(host),lower,map_dom(/tmp/haproxy/mapfiles/68a872db83f1c2.66681443.txt,homepage-webui)] if acl_68a88bcbc80209.70803030 acl_68a885aae80c10.90079068
    # ACTION: NOAA Hosts
    use_backend %[req.hdr(host),lower,map_dom(/tmp/haproxy/mapfiles/68a87348a573f4.40650822.txt,homepage-webui)] if acl_68a884cc6b90c7.72313124
    # ACTION: External Hosts
    use_backend %[req.hdr(host),lower,map_dom(/tmp/haproxy/mapfiles/68a8732c490f82.25124846.txt,homepage-webui)] if acl_68a885aae80c10.90079068

# Frontend: MariaDBS (Secure MariaDB)
frontend MariaDBS
    bind 10.1.3.1:3306 name 10.1.3.1:3306 
    mode tcp
    default_backend maxscale-secure

    # logging options

# Frontend: MariaDB (Insecure MariaDB)
frontend MariaDB
    bind 10.1.3.1:3307 name 10.1.3.1:3307 
    mode tcp
    default_backend maxscale-insecure

    # logging options

# Frontend: PostgreSQL (PostgreSQL)
frontend PostgreSQL
    bind 10.1.3.1:5432 name 10.1.3.1:5432 
    mode tcp

    # logging options

# Backend: authentik-webui (Authentik WebUI)
backend authentik-webui
    option log-health-checks
    # health check: Authentik
    option httpchk
    http-check send meth GET uri /-/health/ready/
    http-check expect status 200
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    server authentik-01 authentik-01.podcake.net:443 check inter 10s  ssl alpn h2,http/1.1 verify none resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a85ff441612271545037

# Backend: gitlab-noaa-webui (NOAA Gitlab WebUI)
backend gitlab-noaa-webui
    option log-health-checks
    # health check: Gitlab
    option httpchk
    http-check send meth GET uri /-/health
    http-check expect status 404
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server noaa-gitlab-01 noaa-gitlab-01.podcake.net:80 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a860d536357684613559

# Backend: headscale (Headscale)
backend headscale
    option log-health-checks
    # health check: Headscale
    option httpchk
    http-check send meth GET uri /health
    http-check expect rstring pass
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    server headscale-01 headscale-01.podcake.net:8080 check inter 10s  ssl alpn h2,http/1.1 verify none resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a861fd27fbc778311024

# Backend: homeassistant-webui (Homeassistant WebUI)
backend homeassistant-webui
    option log-health-checks
    # health check: Homeassistant
    option httpchk
    http-check send meth GET uri /
    http-check expect status 200
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server ha-01 ha-01.iot.podcake.net:8123 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a8621c821ca950750674

# Backend: homepage-webui (Homepage WebUI)
backend homepage-webui
    option log-health-checks
    # health check: Homepage
    option httpchk
    http-check send meth GET uri /
    http-check expect status 200
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server homepage-01 homepage-01.podcake.net:8080 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a862558473e235537831

# Backend: immich-webui (Immich WebUI)
backend immich-webui
    option log-health-checks
    # health check: Immich
    option httpchk
    http-check send meth GET uri /api/server/ping
    http-check expect rstring pong
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server immich-01 immich-01.podcake.net:2283 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a8627a14093490541955

# Backend: jellyfin-webui (Jellyfin WebUI)
backend jellyfin-webui
    option log-health-checks
    # health check: Jellyfin
    option httpchk
    http-check send meth GET uri /health
    http-check expect string Healthy
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    server jellyfin-01 media-01.podcake.net:8920 check inter 10s  proto h2 ssl alpn h2,http/1.1 verify none resolvers 68a8746891e6b9.77735956 resolve-prefer ipv4 source 10.1.3.1 cookie 68a8629d5e7ca288353086

# Backend: jellyseerr-webui (Jellyseerr WebUI)
backend jellyseerr-webui
    option log-health-checks
    # health check: Jellyseerr
    option httpchk
    http-check send meth GET uri /login
    http-check expect status 200
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server jellyseerr-01 media-01.podcake.net:5055 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a862bdca6c9287934409

# Backend: jellystat-webui (Jellystat WebUI)
backend jellystat-webui
    option log-health-checks
    # health check: Jellystat
    option httpchk
    http-check send meth GET uri /
    http-check expect status 200
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server jellystat-01 media-01.podcake.net:3000 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a862ed52da0836486323

# Backend: kavita-webui (Kavita WebUI)
backend kavita-webui
    option log-health-checks
    # health check: Kavita
    option httpchk
    http-check send meth GET uri /api/Health
    http-check expect string Ok
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server kavita-01 media-01.podcake.net:5000 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a8630ed5639972921463

# Backend: komga-webui (Komga WebUI)
backend komga-webui
    option log-health-checks
    # health check: Komga
    option httpchk
    http-check send meth GET uri /actuator/health
    http-check expect rstring UP
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server komga-01 media-01.podcake.net:25600 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a86347bc339806481050

# Backend: lubelogger-webui (LubeLogger WebUI)
backend lubelogger-webui
    option log-health-checks
    # health check: LubeLogger
    option httpchk
    http-check send meth GET uri /Login/Index
    http-check expect status 200
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    server lubelogger-01 homepage-01.podcake.net:8443 check inter 10s  proto h2 ssl alpn h2,http/1.1 verify none resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a8636c0cfa0723620719

# Backend: mealie-webui (Mealie WebUI)
backend mealie-webui
    option log-health-checks
    # health check: Mealie
    option httpchk
    http-check send meth GET uri /api/app/about
    http-check expect rstring production
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server mealie-01 homepage-01.podcake.net:8444 check inter 10s  ssl alpn h2,http/1.1 verify none resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a863d210b12624109204

# Backend: navidrome-webui (Navidrome WebUI)
backend navidrome-webui
    option log-health-checks
    # health check: Navidrome
    option httpchk
    http-check send meth GET uri /ping
    http-check expect string .
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server navidrome-01 media-01.podcake.net:4533 check inter 10s  proto h2 ssl alpn h2,http/1.1 verify none resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a863f945357653979681

# Backend: plant-it-webui (Plant-it WebUI)
backend plant-it-webui
    option log-health-checks
    # health check: Plant-it WebUI
    option httpchk
    http-check send meth GET uri /
    http-check expect status 200
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server plant-it-01 homepage-01.podcake.net:8081 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a8641b2b523643247592

# Backend: plant-it-api (Plant-it API)
backend plant-it-api
    option log-health-checks
    # health check: Plant-It API
    option httpchk
    http-check send meth GET uri /api/info/ping
    http-check expect string pong
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server plant-it-01-api homepage-01.podcake.net:3000 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a864b2d9552939887122

# Backend: portainer-webui (Portainer WebUI)
backend portainer-webui
    option log-health-checks
    # health check: Portainer
    option httpchk
    http-check send meth GET uri /api/system/status
    http-check expect rstring Version
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    server portainer-01 portainer-01.podcake.net:9443 check inter 10s  ssl alpn h2,http/1.1 verify none resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a864eb1befe869976239

# Backend: proxmox-webui (Proxmox WebUI)
backend proxmox-webui
    option log-health-checks
    # health check: Proxmox
    option httpchk
    http-check send meth GET uri /
    http-check expect status 200
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    server proxmox-hightopp hightopp.podcake.net:8006 check inter 10s  ssl alpn h2,http/1.1 verify none resolvers 68a8746891e6b9.77735956 source 10.1.4.1 cookie 68a8650fa5de8947424215

# Backend: semaphore-webui (Semaphore WebUI)
backend semaphore-webui
    option log-health-checks
    # health check: Semaphore
    option httpchk
    http-check send meth GET uri /api/ping
    http-check expect rstring pong
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    server semaphore-lydia lydia.podcake.net:3000 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a8653c21e79294346626

# Backend: speedtest-tracker-webui (Speedtest Tracker WebUI)
backend speedtest-tracker-webui
    option log-health-checks
    # health check: Speedtest-Tracker
    option httpchk
    http-check send meth GET uri /admin/login
    http-check expect status 400
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    server speedtest-tracker-01 homepage-01.podcake.net:8445 check inter 10s  proto h2 ssl alpn h2,http/1.1 verify none resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a8656b86412262813523

# Backend: suwayomi-webui (Suwayomi WebUI)
backend suwayomi-webui
    option log-health-checks
    # health check: Suwayomi
    option httpchk
    http-check send meth GET uri /login.html
    http-check expect status 200
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    server suwayomi-01 media-01.podcake.net:4567 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a86594de490759527724

# Backend: tubearchivisit-webui (TubeArchivist WebUI)
backend tubearchivisit-webui
    option log-health-checks
    # health check: TubeArchivist
    option httpchk
    http-check send meth GET uri /
    http-check expect status 200
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server tubearchivisit-01 media-01.podcake.net:8000 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a865b6b8141260077178

# Backend: uptime-kuma-webui (Uptime Kuma WebUI)
backend uptime-kuma-webui
    option log-health-checks
    # health check: Uptime-Kuma
    option httpchk
    http-check send meth GET uri /dashboard
    http-check expect status 200
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server uptime-kuma-01 homepage-01.podcake.net:8082 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a865e3c9cfe178172331

# Backend: urbackup-webui (UrBackup WebUI)
backend urbackup-webui
    option log-health-checks
    # health check: UrBackup WebUI
    option httpchk
    http-check send meth GET uri /
    http-check expect status 200
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server backup-01 backup-01.podcake.net:55414 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a8662619a12319929274

# Backend: urbackup-internet (UrBackup Internet)
backend urbackup-internet
    option log-health-checks
    # health check: UrBackup Internet
    mode tcp
    balance leastconn
    # stickiness
    stick-table type ip size 1m expire 30m  
    stick on src
    server backup-01-internet backup-01.podcake.net:55415 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 send-proxy-v2 check-send-proxy send-proxy-v2-ssl-cn

# Backend: vaultwarden-webui (Vaultwarden WebUI)
backend vaultwarden-webui
    option log-health-checks
    # health check: Vaultwarden
    option httpchk
    http-check send meth GET uri /
    http-check expect status 200
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server vaultwarden-01 homepage-01.podcake.net:8086 check inter 2s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a86646569ea279116459

# Backend: wallos-webui (Wallos WebUI)
backend wallos-webui
    option log-health-checks
    # health check: Wallos
    option httpchk
    http-check send meth GET uri /login.php
    http-check expect status 200
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server wallos-01 homepage-01.podcake.net:8083 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a866a214d78312403330

# Backend: wud-webui (WUD WebUI)
backend wud-webui
    option log-health-checks
    # health check: WUD
    option httpchk
    http-check send meth GET uri /api/app
    http-check expect rstring wud
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server wud-01 wud-01.podcake.net:3000 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a866bc2763c010235771

# Backend: deluge-webui (Deluge WebUI)
backend deluge-webui
    option log-health-checks
    # health check: Deluge
    option httpchk
    http-check send meth GET uri /
    http-check expect status 200
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server deluge-01 media-01.podcake.net:8112 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a866e109f52049048160

# Backend: lidarr-webui (Lidarr WebUI)
backend lidarr-webui
    option log-health-checks
    # health check: *Arr
    option httpchk
    http-check send meth GET uri /ping
    http-check expect rstring OK
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  

    http-reuse safe
    server lidarr-01 media-01.podcake.net:8686 check inter 10s check-ssl  proto h2 ssl alpn h2,http/1.1 verify none resolvers 68a8746891e6b9.77735956 resolve-prefer ipv4 source 10.1.3.1

# Backend: mylar-webui (Mylar3 WebUI)
backend mylar-webui
    option log-health-checks
    # health check: Mylar
    option httpchk
    http-check send meth GET uri /auth/login
    http-check expect status 200
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server mylar-01 media-01.podcake.net:8090 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a8687977f07480804887

# Backend: prowlarr-webui (Prowlarr WebUI)
backend prowlarr-webui
    option log-health-checks
    # health check: *Arr
    option httpchk
    http-check send meth GET uri /ping
    http-check expect rstring OK
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server prowlarr-01 media-01.podcake.net:9696 check inter 10s check-ssl  proto h2 ssl alpn h2,http/1.1 verify none resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a8689f165f9113401171

# Backend: radarr-webui (Radarr WebUI)
backend radarr-webui
    option log-health-checks
    # health check: *Arr
    option httpchk
    http-check send meth GET uri /ping
    http-check expect rstring OK
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server radarr-01 media-01.podcake.net:7878 check inter 10s check-ssl  proto h2 ssl alpn h2,http/1.1 verify none resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a86a9851614884849855

# Backend: readarr-webui (Readarr WebUI)
backend readarr-webui
    option log-health-checks
    # health check: *Arr
    option httpchk
    http-check send meth GET uri /ping
    http-check expect rstring OK
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server readarr-01 media-01.podcake.net:8787 check inter 10s check-ssl  proto h2 ssl alpn h2,http/1.1 verify none resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a86af28c95e690722805

# Backend: sabnzbd-webui (SABnzbd WebUI)
backend sabnzbd-webui
    option log-health-checks
    # health check: SABnzbd
    option httpchk
    http-check send meth GET uri /api?mode=version
    http-check expect rstring version
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server sabnzbd-01 media-01.podcake.net:8443 check inter 10s  ssl alpn h2,http/1.1 verify none resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a86b150d5bb751403437

# Backend: sonarr-webui (Sonarr WebUI)
backend sonarr-webui
    option log-health-checks
    # health check: *Arr
    option httpchk
    http-check send meth GET uri /ping
    http-check expect rstring OK
    mode http
    balance source
    # stickiness
    stick-table type ip size 50k expire 30m  
    cookie SRVCOOKIE prefix
    http-reuse safe
    option forwarded 
    option forwardfor
    http-request cache-use opnsense-haproxy-cache
    http-response cache-store opnsense-haproxy-cache
    server sonarr-01 media-01.podcake.net:8989 check inter 10s check-ssl  proto h2 ssl alpn h2,http/1.1 verify none resolvers 68a8746891e6b9.77735956 source 10.1.3.1 cookie 68a86b2bd5c7f645210020

# Backend: maxscale-insecure (Maxscale Servers Insecure Connection)
backend maxscale-insecure
    option log-health-checks
    # health check: MariaDB-Insecure
    option mysql-check user haproxy post-41
    mode tcp
    balance leastconn
    # stickiness
    stick-table type ip size 1m expire 30m  
    stick on src
    server maxscale-01-insecure 10.1.3.20:3307 check inter 10s port 3307 no-check-ssl  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 send-proxy-v2
    server maxscale-02-insecure 10.1.3.21:3307 check inter 10s port 3307 no-check-ssl  resolvers 68a8746891e6b9.77735956 source 10.1.3.1 send-proxy-v2

# Backend: maxscale-secure (Maxscale Servers Secure Connection)
backend maxscale-secure
    # health checking is DISABLED
    mode tcp
    balance leastconn
    # stickiness
    stick-table type ip size 1m expire 30m  
    stick on src
    server maxscale-01-secure 10.1.3.20:3306 resolvers 68a8746891e6b9.77735956 source 10.1.3.1 send-proxy-v2-ssl-cn
    server maxscale-02-secure 10.1.3.21:3306 resolvers 68a8746891e6b9.77735956 source 10.1.3.1 send-proxy-v2-ssl-cn

# Backend: postgres-servers (PostgreSQL Servers)
backend postgres-servers
    option log-health-checks
    # health check: PostgreSQL
    option pgsql-check user haproxy
    mode tcp
    balance leastconn
    # stickiness
    stick-table type ip size 1m expire 30m  
    stick on src
    server postgres-01 db-postgres-01.podcake.net:6432 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1
    server postgres-02 db-postgres-02.podcake.net:6432 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1
    server postgres-03 db-postgres-03.podcake.net:6432 check inter 10s  resolvers 68a8746891e6b9.77735956 source 10.1.3.1



listen local_statistics
    bind            127.0.0.1:8822
    mode            http
    stats uri       /haproxy?stats
    stats realm     HAProxy\ statistics
    stats admin     if TRUE

listen  remote_statistics
    bind            10.1.3.1:8822
    mode            http
    stats uri       /haproxy?stats
    stats hide-version

